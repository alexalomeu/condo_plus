<div class="container mt-4">
  <!-- Header -->
  <div class="mb-4">
    <h1 class="fw-bold text-primary">Mensageria</h1>
    <p class="text-muted">Chat com síndicos e condomínios</p>
  </div>

  <div class="row g-4">
    <!-- Lista de conversas -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-body">
          <h5 class="fw-semibold mb-3">Conversas</h5>
          <div class="overflow-auto" style="max-height: 500px;">
            <% @chats = [
              { id: 1, name: "Residencial Jardim", last_message: "Reunião confirmada", unread: 2 },
              { id: 2, name: "Condomínio Vista Verde", last_message: "Tudo certo!", unread: 0 }
            ] %>

            <% @chats.each do |chat| %>
              <div class="d-flex align-items-center p-2 mb-2 rounded-3 chat-item <%= 'bg-light border' if chat[:id] == 1 %>" role="button">
                <div class="me-3 bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                  <i class="bi bi-chat-dots"></i>
                </div>
                <div class="flex-grow-1">
                  <p class="mb-0 fw-semibold text-truncate"><%= chat[:name] %></p>
                  <p class="text-muted small mb-0 text-truncate"><%= chat[:last_message] %></p>
                </div>
                <% if chat[:unread].positive? %>
                  <span class="badge bg-primary rounded-circle"><%= chat[:unread] %></span>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Área do chat -->
    <div class="col-md-8">
      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-body d-flex flex-column" style="height: 600px;">
          <!-- Cabeçalho da conversa -->
          <div class="border-bottom pb-3 mb-3">
            <h5 class="fw-semibold mb-1">Residencial Jardim</h5>
            <p class="text-muted small mb-0">Carlos Oliveira — Síndico</p>
          </div>

          <!-- Mensagens -->
          <div class="flex-grow-1 overflow-auto mb-3 pe-2">
            <% @messages = [
              { id: 1, sender: "Carlos", text: "Bom dia! Sobre a reunião...", time: "10:30", sent: false, read: true },
              { id: 2, sender: "Você", text: "Oi Carlos! Sim, podemos agendar", time: "10:32", sent: true, read: true },
              { id: 3, sender: "Carlos", text: "Perfeito, às 14h?", time: "10:35", sent: false, read: true }
            ] %>

            <% @messages.each do |msg| %>
              <div class="d-flex <%= msg[:sent] ? 'justify-content-end' : 'justify-content-start' %> mb-3">
                <div class="p-3 rounded-3 <%= msg[:sent] ? 'bg-primary text-white' : 'bg-light' %>" style="max-width: 70%;">
                  <% unless msg[:sent] %>
                    <p class="small fw-semibold mb-1"><%= msg[:sender] %></p>
                  <% end %>
                  <p class="mb-1"><%= msg[:text] %></p>
                  <div class="d-flex align-items-center justify-content-end gap-1">
                    <small class="opacity-75"><%= msg[:time] %></small>
                    <% if msg[:sent] && msg[:read] %>
                      <i class="bi bi-check2-all small"></i>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>

          <!-- Input de mensagem -->
          <div class="mt-auto">
            <%= form_with url: "#", method: :post, local: true, class: "d-flex gap-2" do %>
              <%= text_field_tag :message, nil, class: "form-control", placeholder: "Digite sua mensagem..." %>
              <%= button_tag type: :submit, class: "btn btn-primary" do %>
                <i class="bi bi-send"></i>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
